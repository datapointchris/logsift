# Pre-commit hook output patterns
# Patterns to capture error and warning output from pre-commit hooks
# Organized by tool category for maintainability
#
# NOTE: We intentionally omit generic "suggestions" that just restate what
# the linter output says. Suggestions are only included for infrastructure
# issues where the fix involves running specific commands that aren't obvious.

# ============================================================================
# Shell Script Linting - shellcheck
# ============================================================================

[[patterns]]
name = "shellcheck_file_location"
regex = "^In (.+?) line (\\d+):"
severity = "error"
description = "Shellcheck issue location header"
tags = ["pre-commit", "shellcheck", "shell", "location"]

[[patterns]]
name = "shellcheck_error"
regex = "SC(\\d+) \\(error\\): (.+)"
severity = "error"
description = "Shellcheck error with SC code"
tags = ["pre-commit", "shellcheck", "shell", "error"]

[[patterns]]
name = "shellcheck_warning"
regex = "SC(\\d+) \\(warning\\): (.+)"
severity = "warning"
description = "Shellcheck warning with SC code"
tags = ["pre-commit", "shellcheck", "shell", "warning"]

[[patterns]]
name = "shellcheck_info"
regex = "SC(\\d+) \\(info\\): (.+)"
severity = "warning"
description = "Shellcheck info/style suggestion"
tags = ["pre-commit", "shellcheck", "shell", "info", "style"]

[[patterns]]
name = "shellcheck_note"
regex = "SC(\\d+) \\(note\\): (.+)"
severity = "warning"
description = "Shellcheck informational note"
tags = ["pre-commit", "shellcheck", "shell", "note"]

# Specific shellcheck codes for better detection
[[patterns]]
name = "shellcheck_sc2086_quoting"
regex = "SC2086.*Double quote to prevent globbing"
severity = "warning"
description = "Variable expansion needs quoting"
tags = ["pre-commit", "shellcheck", "quoting", "SC2086"]

[[patterns]]
name = "shellcheck_sc2155_declare_assign"
regex = "SC2155.*Declare and assign separately"
severity = "warning"
description = "Declaration and assignment should be separate"
tags = ["pre-commit", "shellcheck", "variables", "SC2155"]

[[patterns]]
name = "shellcheck_sc2034_unused_var"
regex = "SC2034.*appears unused"
severity = "warning"
description = "Variable defined but not used"
tags = ["pre-commit", "shellcheck", "unused", "SC2034"]

[[patterns]]
name = "shellcheck_sc2154_undefined_var"
regex = "SC2154.*is referenced but not assigned"
severity = "warning"
description = "Variable used but not defined"
tags = ["pre-commit", "shellcheck", "undefined", "SC2154"]

[[patterns]]
name = "shellcheck_sc2164_cd_fail"
regex = "SC2164.*Use.*\\|\\| exit.*in case cd fails"
severity = "warning"
description = "cd command should handle failure"
tags = ["pre-commit", "shellcheck", "cd", "SC2164"]

# ============================================================================
# Python Refactoring Suggestions - refurb
# ============================================================================

[[patterns]]
name = "refurb_suggestion"
regex = "^(.+?):(\\d+):(\\d+) \\[FURB(\\d+)\\]: (.+)"
severity = "warning"
description = "Refurb refactoring suggestion"
tags = ["pre-commit", "refurb", "python", "refactoring", "style"]

# ============================================================================
# Python Type Checking - mypy
# ============================================================================

[[patterns]]
name = "mypy_error"
regex = "^(.+?):(\\d+): error: (.+?)  \\[(.+?)\\]"
severity = "error"
description = "Mypy type checking error"
tags = ["pre-commit", "mypy", "python", "type-checking", "error"]

[[patterns]]
name = "mypy_error_no_code"
regex = "^(.+?):(\\d+): error: (.+)$"
severity = "error"
description = "Mypy type checking error (no error code)"
tags = ["pre-commit", "mypy", "python", "type-checking", "error"]

[[patterns]]
name = "mypy_note"
regex = "^(.+?):(\\d+): note: (.+)"
severity = "warning"
description = "Mypy informational note"
tags = ["pre-commit", "mypy", "python", "type-checking", "note"]

[[patterns]]
name = "mypy_warning"
regex = "^(.+?):(\\d+): warning: (.+)"
severity = "warning"
description = "Mypy warning"
tags = ["pre-commit", "mypy", "python", "type-checking", "warning"]

# ============================================================================
# Python Linting - ruff
# ============================================================================

[[patterns]]
name = "ruff_error"
regex = "^(.+?):(\\d+):(\\d+): ([A-Z]\\d+) (.+)"
severity = "error"
description = "Ruff linting error"
tags = ["pre-commit", "ruff", "python", "linting", "error"]

[[patterns]]
name = "ruff_error_simple"
regex = "^(.+?):(\\d+):(\\d+): ([A-Z]\\d+)"
severity = "error"
description = "Ruff linting error (code only)"
tags = ["pre-commit", "ruff", "python", "linting", "error"]

# Specific ruff codes for better detection
[[patterns]]
name = "ruff_f401_unused_import"
regex = "F401.*imported but unused"
severity = "error"
description = "Module imported but never used"
tags = ["pre-commit", "ruff", "import", "F401"]

[[patterns]]
name = "ruff_e501_line_too_long"
regex = "E501.*line too long"
severity = "error"
description = "Line exceeds maximum length"
tags = ["pre-commit", "ruff", "formatting", "E501"]

[[patterns]]
name = "ruff_f841_unused_variable"
regex = "F841.*local variable.*is assigned to but never used"
severity = "error"
description = "Variable assigned but never used"
tags = ["pre-commit", "ruff", "unused", "F841"]

[[patterns]]
name = "ruff_f821_undefined_name"
regex = "F821.*Undefined name"
severity = "error"
description = "Name used but not defined"
tags = ["pre-commit", "ruff", "undefined", "F821"]

# ============================================================================
# Spell Checking - codespell
# ============================================================================

[[patterns]]
name = "codespell_typo"
regex = "^(.+?):(\\d+): (.+?) ==> (.+)"
severity = "warning"
description = "Codespell spelling error"
tags = ["pre-commit", "codespell", "spelling", "typo"]

# ============================================================================
# File Format Validation - check-yaml, check-toml, check-json
# ============================================================================

[[patterns]]
name = "check_yaml_error"
regex = "^  in \"(.+?)\", line (\\d+), column (\\d+)"
severity = "error"
description = "YAML syntax error location"
tags = ["pre-commit", "yaml", "syntax", "validation"]

[[patterns]]
name = "check_toml_error"
regex = "^(.+?): (.+?) \\(at line (\\d+), column (\\d+)\\)"
severity = "error"
description = "TOML syntax error"
tags = ["pre-commit", "toml", "syntax", "validation"]

[[patterns]]
name = "check_json_error"
regex = "^(.+?): Failed to json decode \\((.+?)\\)"
severity = "error"
description = "JSON syntax error"
tags = ["pre-commit", "json", "syntax", "validation"]

# ============================================================================
# File Safety Checks
# ============================================================================

[[patterns]]
name = "check_executable_no_shebang"
regex = "^(.+?): marked executable but has no \\(or invalid\\) shebang!"
severity = "warning"
description = "Executable file missing shebang"
tags = ["pre-commit", "shebang", "executable", "shell"]

[[patterns]]
name = "detect_private_key"
regex = "^Private key found: (.+)"
severity = "error"
description = "Private key detected in repository"
tags = ["pre-commit", "security", "private-key", "secrets"]

# ============================================================================
# Python Security Scanning - bandit
# ============================================================================

[[patterns]]
name = "bandit_issue_header"
regex = "^>> Issue: \\[([A-Z]\\d+):[^\\]]+\\] (.+)"
severity = "warning"
description = "Bandit security issue header"
tags = ["pre-commit", "bandit", "security", "python"]

[[patterns]]
name = "bandit_severity_high"
regex = "^   Severity: High"
severity = "error"
description = "Bandit high severity security issue"
tags = ["pre-commit", "bandit", "security", "python", "high-severity"]

[[patterns]]
name = "bandit_severity_medium"
regex = "^   Severity: Medium"
severity = "warning"
description = "Bandit medium severity security issue"
tags = ["pre-commit", "bandit", "security", "python", "medium-severity"]

[[patterns]]
name = "bandit_location"
regex = "^   Location: (.+?):(\\d+):(\\d+)"
severity = "warning"
description = "Bandit issue location"
tags = ["pre-commit", "bandit", "security", "location"]

# ============================================================================
# Markdown Linting - markdownlint
# ============================================================================

[[patterns]]
name = "markdownlint_error"
regex = "^(.+?):(\\d+) (MD\\d+)/([^\\s]+) (.+?)(?:\\s+\\[Context: \"(.+?)\"\\])?$"
severity = "error"
description = "Markdownlint rule violation"
tags = ["pre-commit", "markdownlint", "markdown", "style"]

# ============================================================================
# Multi-line Error Patterns - CalledProcessError and subprocess failures
# ============================================================================
# context_lines_after tells logsift to extract additional lines for context.

[[patterns]]
name = "pre_commit_called_process_error"
regex = "An unexpected error has occurred: CalledProcessError"
severity = "error"
description = "Pre-commit hook encountered subprocess error"
tags = ["pre-commit", "subprocess", "multi-line"]
context_lines_after = 10

[[patterns]]
name = "stderr_section_error"
regex = "^stderr:\\s*$"
severity = "error"
description = "Marks beginning of stderr output section"
tags = ["stderr", "multi-line", "section-marker"]
context_lines_after = 5

[[patterns]]
name = "pre_commit_hook_failed"
regex = "^- hook id: (.+)$"
severity = "warning"
description = "Pre-commit hook identifier"
tags = ["pre-commit", "hook-id"]

[[patterns]]
name = "pre_commit_exit_code"
regex = "^- exit code: (\\d+)$"
severity = "error"
description = "Pre-commit hook exit code"
tags = ["pre-commit", "exit-code"]

# ============================================================================
# Docker and Infrastructure Errors
# ============================================================================
# Suggestions included here because the fix involves specific commands

[[patterns]]
name = "docker_socket_connection_failure"
regex = "failed to connect to the docker API at unix://([^;\\s]+)"
severity = "error"
description = "Docker daemon not reachable via socket"
tags = ["docker", "infrastructure", "socket"]
suggestion = "Start Docker: 'open -a Docker' or 'colima start'"

[[patterns]]
name = "docker_daemon_not_running"
regex = "Cannot connect to the Docker daemon"
severity = "error"
description = "Docker daemon is not running"
tags = ["docker", "infrastructure", "daemon"]
suggestion = "Start Docker: 'open -a Docker' or 'colima start'"

[[patterns]]
name = "pre_commit_check_log"
regex = "Check the log at (.+\\.log)"
severity = "warning"
description = "Pre-commit suggests checking detailed log"
tags = ["pre-commit", "log-reference"]

# ============================================================================
# Git and Pre-commit Infrastructure Errors
# ============================================================================
# Suggestions included for commands that aren't obvious

[[patterns]]
name = "git_hook_failure"
regex = "git hook .* failed"
severity = "error"
description = "Git hook execution failed"
tags = ["git", "hook", "failure"]

[[patterns]]
name = "pre_commit_environment_error"
regex = "An error has occurred.*environment"
severity = "error"
description = "Pre-commit environment setup failed"
tags = ["pre-commit", "environment", "setup"]
suggestion = "Run: pre-commit clean && pre-commit install --install-hooks"

[[patterns]]
name = "pre_commit_hook_install_failed"
regex = "Failed to install.*hook"
severity = "error"
description = "Hook installation failed"
tags = ["pre-commit", "install", "hook"]
suggestion = "Run: pre-commit install --install-hooks"

# ============================================================================
# Python Build and Package Errors
# ============================================================================

[[patterns]]
name = "pip_install_failed"
regex = "pip.*install.*failed"
severity = "error"
description = "pip package installation failed"
tags = ["python", "pip", "install"]

[[patterns]]
name = "module_not_found"
regex = "ModuleNotFoundError: No module named '(.+)'"
severity = "error"
description = "Python module not installed"
tags = ["python", "import", "module"]

[[patterns]]
name = "syntax_error_python"
regex = "SyntaxError: (.+)"
severity = "error"
description = "Python syntax error"
tags = ["python", "syntax", "error"]

# ============================================================================
# uv Package Manager Patterns
# ============================================================================
# Suggestions included for specific commands

[[patterns]]
name = "uv_sync_failed"
regex = "uv.*sync.*failed"
severity = "error"
description = "uv dependency sync failed"
tags = ["uv", "sync", "dependencies"]
suggestion = "Run: uv sync"

[[patterns]]
name = "uv_lock_outdated"
regex = "uv.lock.*out of date"
severity = "warning"
description = "Lock file needs update"
tags = ["uv", "lock", "dependencies"]
suggestion = "Run: uv lock"
